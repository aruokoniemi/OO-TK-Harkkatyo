PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE storage (
    name VARCHAR(20) PRIMARY KEY
);
CREATE TABLE city (
    CityID INTEGER PRIMARY KEY,
    name VARCHAR(20) UNIQUE
);
CREATE TABLE postalnumber (
    number VARCHAR(5),
    city VARCHAR(20),
    
    PRIMARY KEY (number, city),
    FOREIGN KEY (city) REFERENCES city(name)
);
CREATE TABLE address (
    AddressID INTEGER PRIMARY KEY,
    localaddress  VARCHAR(30),
    city VARCHAR(20),
    postalnumber VARCHAR(5), 

    FOREIGN KEY (city) REFERENCES city(name),
    FOREIGN KEY (postalnumber) REFERENCES postalnumber(number)
);
CREATE TABLE location (
    LocationID INTEGER PRIMARY KEY,
    latitude VARCHAR(20) NOT NULL,
    longitude VARCHAR(20) NOT NULL
);
CREATE TABLE postoffice (
    PostOfficeID INTEGER PRIMARY KEY, 
    name VARCHAR(20)
);
CREATE TABLE smartpost (
    SmartPostID INTEGER PRIMARY KEY UNIQUE NOT NULL,
    LocationID INTEGER,
    AddressID INTEGER,
    availability VARCHAR(50),
    postoffice VARCHAR(20),

    FOREIGN KEY (PostOffice) REFERENCES postoffice(name),
    FOREIGN KEY (LocationID) REFERENCES location(locationid),
    FOREIGN KEY (addressid) REFERENCES address(addressid)
);
CREATE TABLE session (
    SessionID INTEGER PRIMARY KEY,
    username VARCHAR(20)
);
CREATE TABLE logmessage (
    LogMessageID INTEGER PRIMARY KEY,
    SessionID INTEGER NOT NULL,
    message VARCHAR(30),
    packageID INTEGER,
    logdate DATETIME NOT NULL,
    distance DOUBLE,

    FOREIGN KEY (sessionid) REFERENCES session(sessionid),
    FOREIGN KEY (packageid) REFERENCES package(packageid)
);
CREATE TABLE package (
    PackageID INTEGER PRIMARY KEY UNIQUE,
    SenderID INTEGER,
    ReceiverID INTEGER,

    storage VARCHAR(20),
    sent INTEGER DEFAULT 0,    
    

    class INTEGER NOT NULL,

    FOREIGN KEY (senderid) REFERENCES smartpost(smartpostid),
    FOREIGN KEY (receiverid) REFERENCES smartpost(smartpostid),
    FOREIGN KEY (storage) REFERENCES storage(name)
);
CREATE TABLE packageditem (
    ItemID INTEGER PRIMARY KEY UNIQUE NOT NULL,  
    PackageID INTEGER,

    name VARCHAR(40),
    size INTEGER NOT NULL,
    weight INTEGER NOT NULL,
    broken INTEGER DEFAULT 0,    
    breakable INTEGER DEFAULT 0,

    FOREIGN KEY (PackageID) REFERENCES package(PackageID)
);
COMMIT;
